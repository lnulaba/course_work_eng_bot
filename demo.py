#!/usr/bin/env python3
"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è English Learning Bot
–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –∑–≥—ñ–¥–Ω–æ –∑ –¥—ñ–∞–≥—Ä–∞–º–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
"""

import asyncio
import sys
from db import Connection, DB

async def demo_database():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö"""
    print("üîó –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö...")
    
    connection = Connection()
    await connection.connect()
    
    db = DB(connection.connection)
    
    print("üìä –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å...")
    await db.create_tables()
    
    print("üìù –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö...")
    await db.insert_sample_data()
    
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –≥–æ—Ç–æ–≤–∞!")
    
    # –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π
    print("\nüß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π...")
    
    # –¢–µ—Å—Ç —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    test_telegram_id = 123456789
    result = await db.register_user(test_telegram_id, "testuser", "Test User")
    print(f"üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {'‚úÖ' if result else '‚ùå'}")
    
    # –¢–µ—Å—Ç –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    user = await db.get_user(test_telegram_id)
    print(f"üë§ –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {'‚úÖ' if user else '‚ùå'}")
    if user:
        print(f"   üìä –†—ñ–≤–µ–Ω—å: {user['level_english']}")
        print(f"   üìà –¢–æ—á–Ω—ñ—Å—Ç—å: {user['accuracy']}%")
    
    # –¢–µ—Å—Ç –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ª—ñ–≤
    words = await db.get_words_by_level("A1", 5)
    print(f"üìö –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ª—ñ–≤ A1: {'‚úÖ' if words else '‚ùå'} ({len(words)} —Å–ª—ñ–≤)")
    
    # –¢–µ—Å—Ç –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ–º
    topics = await db.get_topics_by_level("A1")
    print(f"üéØ –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ–º A1: {'‚úÖ' if topics else '‚ùå'} ({len(topics)} —Ç–µ–º)")
    
    # –¢–µ—Å—Ç –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    settings = await db.get_user_settings(test_telegram_id)
    print(f"‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {'‚úÖ' if settings else '‚ùå'}")
    
    # –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    stats = await db.get_user_statistics(test_telegram_id)
    print(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {'‚úÖ' if stats else '‚ùå'}")
    
    await connection.connection.close()
    print("\n‚ú® –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")

def demo_bot_features():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ–π –±–æ—Ç–∞"""
    print("\nü§ñ –î–ï–ú–û–ù–°–¢–†–ê–¶–Ü–Ø –§–£–ù–ö–¶–Ü–ô ENGLISH LEARNING BOT")
    print("=" * 50)
    
    print("\nüìö –ê–õ–ì–û–†–ò–¢–ú–ò –ó–ì–Ü–î–ù–û –ó –î–Ü–ê–ì–†–ê–ú–û–Æ –ê–ö–¢–ò–í–ù–û–°–¢–Ü:")
    print("  1. üîê –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–ë–ª–æ–∫-—Å—Ö–µ–º–∞ 1)")
    print("     ‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞")
    print("     ‚Ä¢ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É")
    print("     ‚Ä¢ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—É")
    print("     ‚Ä¢ –í—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è —Ç–µ—Å—Ç—É")
    
    print("\n  2. üìö –í–∏–≤—á–µ–Ω–Ω—è —Å–ª—ñ–≤ (–ë–ª–æ–∫-—Å—Ö–µ–º–∞ 3)")
    print("     ‚Ä¢ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è 20 —Å–ª—ñ–≤ –∑–∞ —Ä—ñ–≤–Ω–µ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞")
    print("     ‚Ä¢ –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –ø—Ä–æ—Ü–µ—Å '–ó–Ω–∞—é/–ù–µ –∑–Ω–∞—é'")
    print("     ‚Ä¢ –ü–æ–∫–∞–∑ –ø–µ—Ä–µ–∫–ª–∞–¥—É –¥–ª—è –Ω–µ–∑–Ω–∞–π–æ–º–∏—Ö —Å–ª—ñ–≤")
    print("     ‚Ä¢ –í—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—É–¥—ñ–æ (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–µ)")
    print("     ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–µ—Å—ñ—ó")
    print("     ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤")
    
    print("\n  3. üß† –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ—Å—Ç—ñ–≤ —á–µ—Ä–µ–∑ ChatGPT (–ë–ª–æ–∫-—Å—Ö–µ–º–∞ 2)")
    print("     ‚Ä¢ –í–∏–±—ñ—Ä —Ç–µ–º–∏ –∑ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–ª—è —Ä—ñ–≤–Ω—è")
    print("     ‚Ä¢ –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—É –¥–ª—è ChatGPT")
    print("     ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è 20 –ø–∏—Ç–∞–Ω—å multiple choice")
    print("     ‚Ä¢ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–∏—Ç–∞–Ω—å –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö")
    print("     ‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—è —Ç–µ—Å—Ç—É –∑ –≤—ñ–¥–≥—É–∫–∞–º–∏")
    print("     ‚Ä¢ –ê–Ω–∞–ª—ñ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó")
    
    print("\n  4. üìä –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É (–ë–ª–æ–∫-—Å—Ö–µ–º–∞ 4)")
    print("     ‚Ä¢ –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞")
    print("     ‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ —Ç–∞ —Ç–∏–∂–¥–µ–Ω—å")
    print("     ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–æ—Å—è–≥–Ω–µ–Ω—å")
    print("     ‚Ä¢ –ê–Ω–∞–ª—ñ–∑ —Ç–µ–Ω–¥–µ–Ω—Ü—ñ–π –Ω–∞–≤—á–∞–Ω–Ω—è")
    print("     ‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó")
    print("     ‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –¥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è")
    
    print("\n  5. ‚öôÔ∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ (–ë–ª–æ–∫-—Å—Ö–µ–º–∞ 5)")
    print("     ‚Ä¢ –ó–º—ñ–Ω–∞ –º–æ–≤–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É (UA/EN/RU/PL)")
    print("     ‚Ä¢ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —â–æ–¥–µ–Ω–Ω–æ—ó —Ü—ñ–ª—ñ (10-500 –ø–∏—Ç–∞–Ω—å)")
    print("     ‚Ä¢ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —á–∞—Å–æ–º –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å")
    print("     ‚Ä¢ –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è –∑–≤—É–∫—É")
    print("     ‚Ä¢ –¢–µ—Å—Ç –Ω–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è")
    print("     ‚Ä¢ –°–∫–∏–¥–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É (–∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º)")
    
    print("\nüóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ò–• (7 –¢–ê–ë–õ–ò–¶–¨):")
    print("  ‚Ä¢ users - –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ Telegram")
    print("  ‚Ä¢ user_progress - –ø—Ä–æ–≥—Ä–µ—Å –Ω–∞–≤—á–∞–Ω–Ω—è")
    print("  ‚Ä¢ settings - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è")
    print("  ‚Ä¢ topics - —Ç–µ–º–∏ –¥–ª—è —Ç–µ—Å—Ç—ñ–≤")
    print("  ‚Ä¢ words - —Å–ª–æ–≤–Ω–∏–∫ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–∞–º–∏ —Ç–∞ –∞—É–¥—ñ–æ")
    print("  ‚Ä¢ questions - –ø–∏—Ç–∞–Ω–Ω—è (–≤–∫–ª—é—á–Ω–æ –∑ AI-–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–º–∏)")
    print("  ‚Ä¢ test_sessions - —ñ—Å—Ç–æ—Ä—ñ—è —Å–µ—Å—ñ–π —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è")
    
    print("\nüéØ –†–Ü–í–ù–Ü CEFR:")
    levels = ["A0 (–ü–æ—á–∞—Ç–∫–æ–≤–∏–π)", "A1 (–ï–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–∏–π)", "A2 (–ë–∞–∑–æ–≤–∏–π)", 
              "B1 (–°–µ—Ä–µ–¥–Ω—ñ–π)", "B2 (–í–∏—â–µ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ)", "C1 (–ü—Ä–æ—Å—É–Ω—É—Ç–∏–π)", "C2 (–í—ñ–ª—å–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è)"]
    for level in levels:
        print(f"  ‚Ä¢ {level}")
    
    print("\nüöÄ –ó–ê–ü–£–°–ö –ë–û–¢–ê:")
    print("  1. pip install -r requirements.txt")
    print("  2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ .env —Ñ–∞–π–ª (BOT_TOKEN, OPENAI_API_KEY)")
    print("  3. python main.py")
    print("  4. –ó–Ω–∞–π—Ç–∏ –±–æ—Ç–∞ –≤ Telegram —Ç–∞ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ /start")

async def main():
    """–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó"""
    print("üéì ENGLISH LEARNING BOT DEMO")
    print("–ö—É—Ä—Å–æ–≤–∞ —Ä–æ–±–æ—Ç–∞ –∑ –ø–æ–≤–Ω–æ—é —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é –¥—ñ–∞–≥—Ä–∞–º–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ")
    print("=" * 60)
    
    # –ü–æ–∫–∞–∑–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –±–æ—Ç–∞
    demo_bot_features()
    
    # –ó–∞–ø–∏—Ç–∞—Ç–∏ —á–∏ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö
    print("\n" + "=" * 60)
    response = input("üß™ –ë–∞–∂–∞—î—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö? (y/n): ")
    
    if response.lower() in ['y', 'yes', '—Ç–∞–∫', '–¥']:
        try:
            await demo_database()
        except Exception as e:
            print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö: {e}")
            print("üí° –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤ db.py")
    else:
        print("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö")
    
    print("\n" + "=" * 60)
    print("üìã –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò:")
    print("  1. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤ .env")
    print("  2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞: python main.py")
    print("  3. –ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤ Telegram")
    print("  4. –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ *.png")
    print("\nüéâ –î—è–∫—É—î–º–æ –∑–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è English Learning Bot!")

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("\nüëã –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—é –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º")
    except Exception as e:
        print(f"\n‚ùå –ü–æ–º–∏–ª–∫–∞: {e}")
        sys.exit(1)
