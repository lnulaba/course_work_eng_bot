@startuml flowchart_2_chatgpt_test_generation
!theme plain
skinparam backgroundColor White
skinparam activity {
    BackgroundColor LightCyan
    BorderColor DarkCyan
    FontColor Black
    FontSize 11
}
skinparam decision {
    BackgroundColor LightYellow
    BorderColor Orange
}
skinparam activityStart {
    Color Green
}
skinparam activityEnd {
    Color Red
}

title **–ë–ª–æ–∫-—Å—Ö–µ–º–∞ 2: –ê–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–µ—Å—Ç—ñ–≤ —á–µ—Ä–µ–∑ ChatGPT**

start

:üß† –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î "–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ—Å—Ç—ñ–≤";

:üë§ –û—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞;
note right
    SELECT level_english 
    FROM user_progress 
    WHERE user_id = ?
end note

:üéØ –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç–µ–º–∏;
note right
    SELECT topic_id, topic_name, description
    FROM topics 
    WHERE difficulty_level <= ? 
    AND is_active = TRUE
    ORDER BY topic_name
end note

if (üìã –¢–µ–º–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ?) then (‚úÖ –¢–ê–ö)
    :üì± –í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ç–µ–º;
    note right
        "–û–±–µ—Ä–∏ —Ç–µ–º—É –¥–ª—è —Ç–µ—Å—Ç—É:
        
        üìù –ì—Ä–∞–º–∞—Ç–∏–∫–∞:
        ‚Ä¢ Present Simple
        ‚Ä¢ Past Simple  
        ‚Ä¢ Present Perfect
        ‚Ä¢ Modal Verbs
        
        üìö –õ–µ–∫—Å–∏–∫–∞:
        ‚Ä¢ Daily Routine
        ‚Ä¢ Food & Drink
        ‚Ä¢ Travel & Tourism
        ‚Ä¢ Business English
        
        üìñ –ß–∏—Ç–∞–Ω–Ω—è:
        ‚Ä¢ Short Stories
        ‚Ä¢ News Articles
        ‚Ä¢ Instructions"
    end note
    
    :üëÜ –ß–µ–∫–∞—Ç–∏ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞;
    
    :üéØ –û—Ç—Ä–∏–º–∞—Ç–∏ –æ–±—Ä–∞–Ω—É —Ç–µ–º—É;
    note right
        topic_id = user_choice
        SELECT topic_name, difficulty_level
        FROM topics WHERE topic_id = ?
    end note
    
    :ü§ñ **–ü–Ü–î–ì–û–¢–û–í–ö–ê –ó–ê–ü–ò–¢–£ –î–û ChatGPT**;
    
    :üìù –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—É;
    note right
        prompt = f"""
        Generate exactly 20 English test questions about {topic_name} 
        for {level_english} level students.
        
        Requirements:
        - Multiple choice format (A, B, C, D)
        - Questions in English
        - Appropriate difficulty for {level_english} level
        - Include grammar, vocabulary, and comprehension
        - Return as JSON array
        
        JSON format:
        [
          {
            "question": "She ___ to work every day.",
            "options": {
              "A": "go",
              "B": "goes", 
              "C": "going",
              "D": "gone"
            },
            "correct_answer": "B",
            "explanation": "Present Simple 3rd person singular"
          }
        ]
        """
    end note
    
    :üåê **–í–ò–ö–õ–ò–ö ChatGPT API**;
    note right
        POST https://api.openai.com/v1/chat/completions
        {
          "model": "gpt-3.5-turbo",
          "messages": [
            {"role": "system", "content": "You are an English teacher creating tests"},
            {"role": "user", "content": prompt}
          ],
          "temperature": 0.7,
          "max_tokens": 3000
        }
    end note
    
    if (üîó API –¥–æ—Å—Ç—É–ø–Ω–∏–π?) then (‚úÖ –¢–ê–ö)
        if (üìã –í—ñ–¥–ø–æ–≤—ñ–¥—å –æ—Ç—Ä–∏–º–∞–Ω–æ?) then (‚úÖ –¢–ê–ö)
            :üìÑ –ü–∞—Ä—Å–∏–Ω–≥ JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ;
            
            if (‚úÖ JSON –≤–∞–ª—ñ–¥–Ω–∏–π?) then (‚úÖ –¢–ê–ö)
                if (üî¢ 20 –ø–∏—Ç–∞–Ω—å –æ—Ç—Ä–∏–º–∞–Ω–æ?) then (‚úÖ –¢–ê–ö)
                    :üíæ **–ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –ü–ò–¢–ê–ù–¨ –í –ë–î**;
                    
                    :üÜî –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è;
                    note right
                        INSERT INTO test_sessions
                        (user_id, session_type, started_at)
                        VALUES (?, 'ai_generated_test', NOW())
                        
                        session_id = LAST_INSERT_ID()
                    end note
                    
                    repeat
                        :üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è;
                        note right
                            INSERT INTO questions
                            (topic_id, question_text, option_a, option_b, 
                            option_c, option_d, correct_answer, 
                            difficulty_level, ai_generated, created_at)
                            VALUES (?, ?, ?, ?, ?, ?, ?, ?, TRUE, NOW())
                        end note
                    repeat while (‚ùì –©–µ —î –ø–∏—Ç–∞–Ω–Ω—è?)
                    
                    :üéØ **–ü–û–ß–ê–¢–û–ö –¢–ï–°–¢–£–í–ê–ù–ù–Ø**;
                    
                    :üî¢ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ;
                    note right
                        current_question = 1
                        correct_answers = 0
                        total_questions = 20
                        start_time = NOW()
                    end note
                    
                    repeat
                        :‚ùì –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è;
                        note right
                            "–ü–∏—Ç–∞–Ω–Ω—è {current_question}/20:
                            
                            {question_text}
                            
                            A) {option_a}
                            B) {option_b}  
                            C) {option_c}
                            D) {option_d}
                            
                            ‚è±Ô∏è –ß–∞—Å—É –∑–∞–ª–∏—à–∏–ª–æ—Å—å: {time_left}"
                        end note
                        
                        :üëÜ –ß–µ–∫–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞;
                        
                        :‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å;
                        
                        if (üéØ –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞?) then (‚úÖ –¢–ê–ö)
                            :‚ûï correct_answers++;
                            :üéâ –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è;
                            note right
                                "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! 
                                
                                üí° –ü–æ—è—Å–Ω–µ–Ω–Ω—è: {explanation}"
                            end note
                            
                        else (‚ùå –ù–Ü)
                            :üìù –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å;
                            note right
                                "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
                                
                                ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: {correct_answer}
                                üí° –ü–æ—è—Å–Ω–µ–Ω–Ω—è: {explanation}"
                            end note
                            
                            :ü§ñ –î–æ–¥–∞—Ç–∫–æ–≤–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ GPT;
                            note right
                                explain_prompt = f"Explain why {correct_answer} 
                                is correct for: {question_text}"
                                
                                GPT response -> detailed_explanation
                            end note
                            
                            :üí° –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è;
                        endif
                        
                        :‚ûï current_question++;
                        
                    repeat while (current_question <= 20?)
                    
                    :üßÆ **–†–û–ó–†–ê–•–£–ù–û–ö –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í**;
                    
                    :üìä –û–±—á–∏—Å–ª–∏—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É;
                    note right
                        accuracy = (correct_answers / 20) * 100
                        session_duration = NOW() - start_time
                        completion_rate = 100  // –≤—Å—ñ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ–π–¥–µ–Ω—ñ
                    end note
                    
                    :üíæ –û–Ω–æ–≤–∏—Ç–∏ —Å–µ—Å—ñ—é;
                    note right
                        UPDATE test_sessions SET
                        questions_answered = 20,
                        correct_answers = ?,
                        completed_at = NOW(),
                        is_completed = TRUE
                        WHERE session_id = ?
                    end note
                    
                    :üìà –û–Ω–æ–≤–∏—Ç–∏ –∑–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å;
                    note right
                        UPDATE user_progress SET
                        total_questions_answered = total_questions_answered + 20,
                        correct_answers = correct_answers + ?,
                        accuracy = (correct_answers / total_questions_answered) * 100,
                        last_updated = NOW()
                        WHERE user_id = ?
                    end note
                    
                    :üéä **–ü–û–ö–ê–ó–ê–¢–ò –†–ï–ó–£–õ–¨–¢–ê–¢–ò**;
                    note right
                        "üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É '{topic_name}':
                        
                        üìä –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: {correct_answers}/20
                        üìà –¢–æ—á–Ω—ñ—Å—Ç—å: {accuracy}%
                        ‚è±Ô∏è –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: {session_duration} —Ö–≤
                        üéØ –†—ñ–≤–µ–Ω—å: {level_english}
                        
                        {performance_message}"
                    end note
                    
                    if (üèÜ –í—ñ–¥–º—ñ–Ω–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?) then (accuracy >= 85%)
                        :üéâ –í—ñ—Ç–∞–Ω–Ω—è –∑ –≤–∏—Å–æ–∫–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º;
                        :‚¨ÜÔ∏è –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è;
                        note right
                            "üèÜ –í—ñ–¥–º—ñ–Ω–Ω–æ! –¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –µ–∫—Å–ø–µ—Ä—Ç!
                            
                            üéì –ú–æ–∂–ª–∏–≤–æ, –≥–æ—Ç–æ–≤–∏–π –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è?
                            –•–æ—á–µ—à –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –Ω–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è?"
                        end note
                        
                        if (üéì –¢–µ—Å—Ç –Ω–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è?) then (‚úÖ –¢–ê–ö)
                            :üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç –≤–∏—â–æ–≥–æ —Ä—ñ–≤–Ω—è;
                            note right: –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å –∑ –≤–∏—â–∏–º —Ä—ñ–≤–Ω–µ–º —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
                        endif
                        
                    elseif (üìö –ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞?) then (accuracy < 60%)
                        :üí™ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è;
                        :üîÑ –ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ —Ç–µ–º—É;
                        note right
                            "üìö –†–µ–∫–æ–º–µ–Ω–¥—É—é –±—ñ–ª—å—à–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∑ —Ü—ñ—î—ó —Ç–µ–º–∏
                            
                            üí° –ö–æ—Ä–∏—Å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏:
                            ‚Ä¢ –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ —Å–ª–æ–≤–∞ –∑ —Ç–µ–º–∏ {topic_name}
                            ‚Ä¢ –ü—Ä–æ–π—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–ø—Ä–∞–≤–∏
                            ‚Ä¢ –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≥—Ä–∞–º–∞—Ç–∏—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞"
                        end note
                    endif
                    
                else (‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø–∏—Ç–∞–Ω—å)
                    :üö® "–ü–æ–º–∏–ª–∫–∞: –æ—Ç—Ä–∏–º–∞–Ω–æ –º–µ–Ω—à–µ 20 –ø–∏—Ç–∞–Ω—å";
                    :üîÑ "–°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑";
                endif
                
            else (‚ùå JSON –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π)
                :üö® "–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ GPT";
                :üîÑ "–°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑";
            endif
            
        else (‚ùå –ü—É—Å—Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å)
            :üö® "ChatGPT –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–≤";
            :üîÑ "–°–ø—Ä–æ–±—É–π –ø—ñ–∑–Ω—ñ—à–µ";
        endif
        
    else (‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π)
        :üåê "–ü—Ä–æ–±–ª–µ–º–∞ –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º –¥–æ ChatGPT";
        :üìã –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≥–æ—Ç–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è –∑ –ë–î;
        note right
            SELECT * FROM questions 
            WHERE topic_id = ? 
            AND difficulty_level = ?
            AND ai_generated = FALSE
            ORDER BY RANDOM() 
            LIMIT 20
        end note
        
        if (üìã –ì–æ—Ç–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è –∑–Ω–∞–π–¥–µ–Ω—ñ?) then (‚úÖ –¢–ê–ö)
            note right: –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –≥–æ—Ç–æ–≤–∏–º–∏ –ø–∏—Ç–∞–Ω–Ω—è–º–∏
        else (‚ùå –ù–Ü)
            :üö® "–ü–∏—Ç–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ";
            :üè† –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –º–µ–Ω—é;
        endif
    endif
    
else (‚ùå –ù–Ü)
    :üö® "–¢–µ–º–∏ –¥–ª—è –≤–∞—à–æ–≥–æ —Ä—ñ–≤–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ";
    :üîß "–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞";
endif

:üè† –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é;

stop

@enduml
