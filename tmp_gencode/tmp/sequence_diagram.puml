@startuml sequence_diagram!theme plainskinparam backgroundColor Whiteskinparam participant {    BackgroundColor LightBlue    BorderColor Navy    FontColor Black}skinparam actor {    BackgroundColor LightGreen    BorderColor DarkGreen}skinparam database {    BackgroundColor LightYellow    BorderColor Orange}title **Діаграма послідовності English Learning Bot**actor "👤 Користувач" as Userparticipant "🤖 Telegram Bot" as Botparticipant "🧠 ChatGPT API" as GPTdatabase "🗄️ MySQL Database" as DBparticipant "📱 Interface" as UI== 🚀 ІНІЦІАЛІЗАЦІЯ ==User -> Bot: /startactivate BotBot -> DB: SELECT * FROM users WHERE telegram_id = ?activate DBDB --> Bot: user_data OR nulldeactivate DBalt 👤 Новий користувач    Bot -> DB: INSERT INTO users (telegram_id, username, created_at)    activate DB    DB --> Bot: user_id    deactivate DB        Bot -> DB: INSERT INTO settings (user_id, preferred_language, daily_goal)    activate DB    DB --> Bot: ✅ settings created    deactivate DB        Bot -> DB: INSERT INTO user_progress (user_id, level_english)    activate DB    DB --> Bot: ✅ progress initialized    deactivate DB        Bot -> UI: 📝 "Привіт! Пройди початковий тест"    Bot -> User: 🎯 Початковий тест (40 слів + граматика)    else 🔑 Існуючий користувач    Bot -> UI: 🏠 Головне меню    Bot -> User: "Вітаю знову! Що будемо вивчати?"enddeactivate Bot== 📚 ВИВЧЕННЯ СЛІВ ==User -> Bot: 📚 "Вивчення слів"activate BotBot -> DB: SELECT level_english FROM user_progress WHERE user_id = ?activate DBDB --> Bot: current_leveldeactivate DBBot -> DB: SELECT word, translation, file_audio FROM words WHERE level_english = ? AND check_admin = TRUE ORDER BY RANDOM() LIMIT 20activate DBDB --> Bot: words_list[20]deactivate DBBot -> DB: INSERT INTO test_sessions (user_id, session_type, started_at)activate DBDB --> Bot: session_iddeactivate DBloop 📖 Для кожного слова (1-20)    Bot -> UI: 👁️ Показати слово    Bot -> User: "Слово: apple 🔊[Аудіо] 💡[Знаю] ❌[Не знаю]"        alt 🔊 Користувач натискає "Аудіо"        User -> Bot: 🔊 Запит аудіо        Bot -> UI: 📢 Відтворити file_audio        Bot -> User: 🎵 Аудіо відтворено    end        User -> Bot: 💡 "Знаю" OR ❌ "Не знаю"        alt 💡 Знає слово        Bot -> UI: ✅ "Чудово!"        note right: known_words++            else ❌ Не знає слово        Bot -> UI: 📝 Показати переклад        Bot -> User: "apple = яблуко"        Bot -> UI: 📢 Автоматично відтворити аудіо        Bot -> User: 💡 "Запам'ятай це слово!"        note right: unknown_words++    endendBot -> DB: UPDATE test_sessions SET questions_answered = 20, correct_answers = ?, completed_at = NOW()activate DBDB --> Bot: ✅ session updateddeactivate DBBot -> DB: UPDATE user_progress SET total_questions_answered = total_questions_answered + 20, correct_answers = correct_answers + ?activate DBDB --> Bot: ✅ progress updateddeactivate DBBot -> UI: 📊 Показати результатиBot -> User: "📊 Результати: ✅[known]/20 ❌[unknown]/20"deactivate Bot== 🧠 ГЕНЕРАЦІЯ ТЕСТІВ ЧЕРЕЗ ChatGPT ==User -> Bot: 🧠 "Генерувати тест"activate BotBot -> UI: 🎯 Показати темиBot -> User: "Вибери тему: 📝Граматика 📚Лексика 📖Читання"User -> Bot: 📝 "Граматика - Present Simple"Bot -> DB: SELECT * FROM topics WHERE topic_name = 'Present Simple'activate DBDB --> Bot: topic_datadeactivate DBBot -> GPT: 🤖 "Generate 20 Present Simple questions for level [user_level]"activate GPTnote right    API Request:    {      "model": "gpt-3.5-turbo",      "messages": [        {"role": "system", "content": "Generate English grammar questions"},        {"role": "user", "content": "Create 20 Present Simple questions for A2 level"}      ]    }end noteGPT --> Bot: 📋 JSON з 20 питаннямиdeactivate GPTBot -> DB: INSERT INTO questions (topic_id, question_text, option_a, option_b, option_c, correct_answer, ai_generated)activate DBDB --> Bot: ✅ 20 questions saveddeactivate DBBot -> DB: INSERT INTO test_sessions (user_id, session_type, started_at)activate DBDB --> Bot: session_iddeactivate DBloop ❓ Для кожного питання (1-20)    Bot -> UI: ❓ Показати питання    Bot -> User: "Question 1/20: She __ to school every day. A) go B) goes C) going"        User -> Bot: "B"        Bot -> DB: SELECT correct_answer FROM questions WHERE question_id = ?    activate DB    DB --> Bot: correct_answer    deactivate DB        alt ✅ Правильна відповідь        Bot -> UI: 🎉 "Правильно!"        Bot -> User: ✅ "Молодець! Продовжуємо"        note right: correct_answers++            else ❌ Неправильна відповідь        Bot -> UI: 📝 Показати правильну відповідь        Bot -> User: "❌ Правильно: B) goes. She goes to school."        Bot -> GPT: 🤖 "Explain Present Simple 3rd person rule"        activate GPT        GPT --> Bot: 💡 Пояснення правила        deactivate GPT        Bot -> User: 💡 "Пояснення: У 3-й особі однини додаємо -s/-es"    end        note right: total_questions++endBot -> DB: UPDATE test_sessions SET questions_answered = 20, correct_answers = ?, completed_at = NOW(), is_completed = TRUEactivate DBDB --> Bot: ✅ session completeddeactivate DBBot -> DB: UPDATE user_progress SET total_questions_answered = total_questions_answered + 20, correct_answers = correct_answers + ?, last_updated = NOW()activate DBDB --> Bot: ✅ progress updateddeactivate DBBot -> UI: 📊 Розрахувати статистикуnote right    accuracy = (correct_answers / 20) * 100    session_time = completed_at - started_atend noteBot -> User: "📊 Результат тесту: [correct]/20 (accuracy%), Час: [minutes] хв"alt 🎯 Високий результат (≥80%)    Bot -> User: 🏆 "Відмінно! Можливо готовий до наступного рівня?"        alt 🎓 Користувач хоче тест на підвищення        User -> Bot: ✅ "Так, хочу тест на підвищення"        Bot -> GPT: 🤖 "Generate level-up test for next level"        activate GPT        GPT --> Bot: 📋 Складніші питання        deactivate GPT        note right: Повторити процес тестування з складнішими питаннями    end    else 📚 Потрібна практика (<50%)    Bot -> User: 💪 "Потрібно більше практики з цієї теми"    Bot -> DB: SELECT * FROM words WHERE level_english <= ? AND topic LIKE '%Present Simple%'    activate DB    DB --> Bot: related_words    deactivate DB    Bot -> User: 📚 "Рекомендую повторити ці слова: [words_list]"enddeactivate Bot== ⚙️ НАЛАШТУВАННЯ ==User -> Bot: ⚙️ "Налаштування"activate BotBot -> DB: SELECT * FROM settings WHERE user_id = ?activate DBDB --> Bot: current_settingsdeactivate DBBot -> UI: 📋 Показати поточні налаштуванняBot -> User: "🌐 Мова: UA 🎯 Щоденна ціль: 50 питань ⏰ Нагадування: 19:00"User -> Bot: 🔧 "Змінити щоденну ціль на 100"Bot -> DB: UPDATE settings SET daily_goal = 100 WHERE user_id = ?activate DBDB --> Bot: ✅ settings updateddeactivate DBBot -> User: ✅ "Налаштування збережено!"deactivate Bot== 📊 СТАТИСТИКА ==User -> Bot: 📊 "Моя статистика"activate BotBot -> DB: SELECT * FROM user_progress WHERE user_id = ?activate DBDB --> Bot: progress_datadeactivate DBBot -> DB: SELECT COUNT(*) FROM test_sessions WHERE user_id = ? AND is_completed = TRUEactivate DBDB --> Bot: total_sessionsdeactivate DBBot -> DB: SELECT AVG(correct_answers/questions_answered) FROM test_sessions WHERE user_id = ?activate DBDB --> Bot: average_accuracydeactivate DBBot -> UI: 📈 Сформувати звітBot -> User: "📊 Твоя статистика:\n🎯 Рівень: [level]\n✅ Правильних відповідей: [correct]/[total]\n📈 Точність: [accuracy]%\n🔥 Пройдено сесій: [sessions]"deactivate Bot@enduml